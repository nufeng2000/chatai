<html lang="en">
<head>
    <meta charSet="utf-8"/>
    <link rel="icon" href="favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="chatbox"/>
    <link rel="apple-touch-icon" href="logo192.png"/>
    <!--    <link rel="manifest" href="manifest.json"/>-->
    <title>ChatAI</title>
    <!--    <script defer="defer" src="static/js/main.js"></script>-->
    <link href="static/css/main.42a83e02.css" rel="stylesheet">
    <style>
        .container {
            position: relative;
            height: 100%; /* 设置高度为视口的高度，以便使内容垂直居中 */
        }

        .content {
            position: absolute;
            top: 50%; /* 让元素上下居中 */
            left: 50%; /* 让元素水平居中 */
            transform: translate(-50%, -50%); /* 通过 transform 属性偏移元素，使文本上下左右居中 */
        }
        .content span {
            display: inline-block; /* 需要把内层元素设置为 inline-block，以便水平居中 */
            text-align: center; /* 水平居中 */
        }
    </style>
    <script type="text/javascript" src="cordova.js"></script>
</head>
<body>
<div id="startpage" className="container" style="position: relative; height: 100%;">
    <div className="content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <span style="display: inline-block; text-align: center;">正在努力加载中......</span>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                 style="opacity: 1.0;margin: auto;
     display: block; shape-rendering: auto;"
                 width="64px" height="64px"
                 viewBox="0 0 100 100"
                 preserveAspectRatio="xMidYMid">
                <circle cx="84" cy="50" r="10" fill="#e15b64">
                    <animate attributeName="r" repeatCount="indefinite" dur="0.5s" calcMode="spline" keyTimes="0;1"
                             values="10;0" keySplines="0 0.5 0.5 1" begin="0s"></animate>
                    <animate attributeName="fill" repeatCount="indefinite" dur="2s" calcMode="discrete"
                             keyTimes="0;0.25;0.5;0.75;1" values="#e15b64;#abbd81;#f8b26a;#f47e60;#e15b64"
                             begin="0s"></animate>
                </circle>
                <circle cx="16" cy="50" r="10" fill="#e15b64">
                    <animate attributeName="r" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s"></animate>
                    <animate attributeName="cx" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s"></animate>
                </circle>
                <circle cx="50" cy="50" r="10" fill="#f47e60">
                    <animate attributeName="r" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s"></animate>
                    <animate attributeName="cx" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s"></animate>
                </circle>
                <circle cx="84" cy="50" r="10" fill="#f8b26a">
                    <animate attributeName="r" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-1s"></animate>
                    <animate attributeName="cx" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-1s"></animate>
                </circle>
                <circle cx="16" cy="50" r="10" fill="#abbd81">
                    <animate attributeName="r" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-1.5s"></animate>
                    <animate attributeName="cx" repeatCount="indefinite" dur="2s" calcMode="spline"
                             keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84"
                             keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-1.5s"></animate>
                </circle>
                <!-- [ldio] generated by https://loading.io/ --></svg>
        </div>
    </div>
</div>
<div id="root"></div>
</body>
</html>
<script>
    var {app,Menu} = require('app');  // 控制应用生命周期的模块。
    var BrowserWindow = require('browser-window');  // 创建原生浏览器窗口的模块
    Menu.setApplicationMenu(null);
    if (window.process && window.process.versions.electron) {

        const {app, Menu} = require('electron');
        // 禁用 Electron 菜单
        Menu.setApplicationMenu(null);
        app.on('ready', () => {
            const win = new BrowserWindow({
                // width: 800,
                // height: 600,
                autoHideMenuBar: true // 自动隐藏菜单栏
            });
        });
        // app.on('ready', () => {
        //     // ...
        // })
        // // 创建新的菜单
        // const template = [
        //     // ...
        // ];
        // const menu = Menu.buildFromTemplate(template);
        // // 将菜单分配给 BrowserWindow 实例
        // const win = new BrowserWindow({width: 1024, height: 768});
        // win.setMenu(menu);
    }

    function loadScript(src) {
        return new Promise(function (resolve, reject) {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'file:///android_asset/www' + src;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    }

    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        var filePath = 'file:///android_asset/www/asset-manifest.json';

        window.resolveLocalFileSystemURL(
            filePath,
            function (fileEntry) {
                // 获取文件
                fileEntry.file(function (file) {

                    // 创建一个 FileReader 对象
                    var reader = new FileReader();
                    reader.onerror = function (event) {
                        // alert("Failed to read file!\n\n" + reader.error);
                        reader.abort(); // (...does this do anything useful in an onerror handler?)
                    }
                    // 读取文件内容
                    reader.onload = function (event) {
                        var contents = event.target.result; // 获取文件内容
                        // 如果请求成功，则在控制台输出响应的数据
                        console.log(contents);
                        // 将 JSON 字符串转换为 JavaScript 对象
                        var data = JSON.parse(contents);
                        const mainJsFileName = data.files["main.js"];
                        var scripts = [
                            mainJsFileName,
                        ];
                        Promise.all(scripts.map(loadScript))
                            .then(function () {
                                document.getElementById("startpage").hidden = true;
                            })
                            .catch(function () {
                                // console.log('Error occurred while loading script.');
                            });
                        // console.log('file content:', this.result);
                    };

                    // 以文本格式读取文件
                    reader.readAsText(file);
                });
            },
            function (error) {
                // console.log('未找到文件：' + error);
            });

    };

</script>